import numpy as np
import os

def get_LF_constr():

        path = os.path.abspath(__file__)
        dir_path = os.path.dirname(path)

        wu2020_calzetti=np.asarray([-21.5, -4.903846153846153,
        -21.19999999999999, -4.571343858903859,
        -20.849999999999987, -4.205293174007868,
        -20.499999999999986, -3.867846452351513,
        -20.149999999999984, -3.691616393198668,
        -19.799999999999983, -3.5499330932561133,
        -19.44999999999998, -3.3348198370557127,
        -19.09999999999998, -2.9882921530159727,
        -18.74999999999998, -2.6351902715360214,
        -18.399999999999977, -2.3209714143096662,
        -18.049999999999976, -2.1420243785588426,
        -17.699999999999974, -2.0183156223183114,
        -17.349999999999973, -1.8352547417397176,
        -16.99999999999997, -1.6665798570201966,
        -16.64999999999997, -1.4876532860724785,
        -16.29999999999997, -1.3458659800755517,
        -15.949999999999969, -1.193702500356922,
        -15.59999999999997, -1.0611555894168738,
        -15.249999999999968, -1.0355346101164695,
        -14.89999999999997, -1.0573095531724386,
        -14.549999999999969, -1.062721008376458,
        -14.19999999999997, -1.1672706033685498]).reshape((-1,2))

        wu2020_salmon=np.asarray([-22.400000000000006,0.000002997976435672304,
        -22.200000000000006,0.0000046495550518706135,
        -22.000000000000007,0.000008206294331904758,
        -21.800000000000008,0.00001119816493705782,
        -21.60000000000001,0.000016772152699693115,
        -21.40000000000001,0.00003298659596037375,
        -21.20000000000001,0.000038725126557297695,
        -21.00000000000001,0.00007056087323258757,
        -20.80000000000001,0.00011181244689347912,
        -20.600000000000012,0.00016999430784885014,
        -20.400000000000013,0.0002510845426361104,
        -20.200000000000014,0.00024894473002865983,
        -20.000000000000014,0.00036873757171951716,
        -19.800000000000015,0.0004893724198955812,
        -19.600000000000016,0.0006470001518298876,
        -19.400000000000016,0.0009276779313636498,
        -19.200000000000017,0.001245011365434379,
        -19.000000000000018,0.0015470251530295487,
        -18.80000000000002,0.002842172910168963,
        -18.60000000000002,0.004975838783486545,
        -18.40000000000002,0.0048396740044538865,
        -18.20000000000002,0.008359353103650121,
        -18.00000000000002,0.009029276281342882,
        -17.800000000000022,0.010745046383811317,
        -17.600000000000023,0.012160464995216967,
        -17.400000000000023,0.013729345749294398,
        -17.200000000000024,0.017933260710956554,
        -17.000000000000025,0.024336202480462386,
        -16.800000000000026,0.029916140442821263,
        -16.600000000000026,0.038800598961110724,
        -16.400000000000027,0.045207218022380244,
        -16.200000000000028,0.04959132675009073,
        -16.00000000000003,0.05920771713702894,
        -15.80000000000003,0.0714247914739027,
        -15.60000000000003,0.08569824360228281,
        -15.40000000000003,0.09229812999917593,
        -15.200000000000031,0.08821432562170352,
        -15.000000000000032,0.0847441692476615,
        -14.800000000000033,0.08200108017910154,
        -14.600000000000035,0.07591090640143719,
        -14.400000000000036,0.07166569752994614,
        -14.200000000000033,0.06377323919623908]).reshape((-1,2))

        wu2020_nodust=np.asarray([-23.8,0.000019882549416783485,
        -23.6,0.000020276010798628878,
        -23.400000000000002,0.000022456068735999328,
        -23.200000000000003,0.00002983606123947297,
        -23.000000000000004,0.00003973112659612058,
        -22.800000000000004,0.00005281288683588364,
        -22.600000000000005,0.0000699714265763703,
        -22.400000000000006,0.00008645895066190707,
        -22.200000000000006,0.00010139144353317559,
        -22.000000000000007,0.00011872977395203704,
        -21.800000000000008,0.00013961547666267824,
        -21.60000000000001,0.00016492540761173526,
        -21.40000000000001,0.00020402777927261073,
        -21.20000000000001,0.0002595588715685078,
        -21.00000000000001,0.0003258099727333539,
        -20.80000000000001,0.00040611703437632845,
        -20.600000000000012,0.0005113611218631957,
        -20.400000000000013,0.0006709703844286122,
        -20.200000000000014,0.0008992823968404069,
        -20.000000000000014,0.0011940691923676718,
        -19.800000000000015,0.0015763383333564117,
        -19.600000000000016,0.0021240336551192206,
        -19.400000000000016,0.0027961662843329696,
        -19.200000000000017,0.0036181791108919063,
        -19.000000000000018,0.004596489819742965,
        -18.80000000000002,0.005757451176312522,
        -18.60000000000002,0.007378748934250895,
        -18.40000000000002,0.008835423423009066,
        -18.20000000000002,0.009563861908209258,
        -18.00000000000002,0.010686141524881272,
        -17.800000000000022,0.011838485904613553,
        -17.600000000000023,0.013821219893643754,
        -17.400000000000023,0.01515962435379733,
        -17.200000000000024,0.01758650079923027,
        -17.000000000000025,0.022005890255836057,
        -16.800000000000026,0.029078251417654875,
        -16.600000000000026,0.03430587429950492,
        -16.400000000000027,0.04243907365988331,
        -16.200000000000028,0.05637530727528082,
        -16.00000000000003,0.06607931071349722,
        -15.80000000000003,0.07215921838841599,
        -15.60000000000003,0.08615424398688049,
        -15.40000000000003,0.09189992137887668,
        -15.200000000000031,0.09067057861328418,
        -15.000000000000032,0.08664163988871698,
        -14.800000000000033,0.08949850427502941,
        -14.600000000000035,0.08890280540117063,
        -14.400000000000036,0.07165214758330635,
        -14.200000000000033,0.06367571989617465]).reshape((-1,2))

        wu2020_uvlfs=[[6.0],[[wu2020_calzetti, wu2020_salmon, wu2020_nodust]]]
        
        vij20_z6_uvlf=np.asarray([[-17.56,-2.0881653136707197,-2.0336595414894436],
        [-17.839999999999996,-2.243945164979284,-2.0914332822105077],
        [-18.119999999999997,-2.384228135364899,-2.2439062855894325],
        [-18.399999999999995,-2.5397053726250576,-2.38788936371971],
        [-18.679999999999996,-2.6935545253862774,-2.5992512112062034],
        [-18.947286412156924,-2.8353138117651775,-2.7944491786209626],
        [-19.235767185464987,-2.993790382157531,-2.977106462605268],
        [-19.511519226691927,-3.1320910967374362,-3.1512909043556014],
        [-19.79999999999999,-3.2442898277629517,-3.3519496511390847],
        [-20.07999999999999,-3.377016934868502,-3.525653091175387],
        [-20.35999999999999,-3.5193497298428076,-3.699115112413983],
        [-20.639999999999986,-3.6469014922226584,-3.889907137898057],
        [-20.915789901822055,-3.787583184497481,-3.9362143481805743],
        [-21.19999999999999,-3.939565188476717,-3.88059933541585],
        [-21.479999999999983,-4.162079663247493,-3.949755536399656],
        [-21.759999999999984,-4.442019032955019,-4.074853639583297],
        [-22.039999999999985,-4.770197255173478,-4.195110701858054],
        [-22.319999999999983,-5.157728824106459,-4.319102436692754],
        [-22.59999999999998,-5.644068246688005,-4.645703744500903],
        [-22.80334743910933,-5.984873567148509,-4.982502315927544],
        [-23.300500668509915,-5.463735361100405,-5.362636395428891],
        [-23.439999999999976,-6.329863409169234,-3.9723704194088536],
        [-23.799999999999983,-8.243166465647302,0]])


        vij20_z6_uvlf[vij20_z6_uvlf[:,0]>-21,2]=vij20_z6_uvlf[vij20_z6_uvlf[:,0]>-21,1]
        vij20_uvlfs=[[6.0],[[vij20_z6_uvlf]]]

        livermore17_uvlf_z6=np.asarray([[-12.490347490347487,0.5849942606699372,-2.6073069208204336,-0.20779853212285548],
        [-12.99227799227799,0.19532273586327742,-2.534771064500794,-0.06415527496608453],
        [-13.494208494208491,-0.19434878894338237,-2.346919892865839,-0.45380824840284184],
        [-13.996138996138994,-0.584020313750043,-2.000473059932518,-1.3480028290839092],
        [-14.498069498069496,-0.6709891358540001,-1.8126218882975627,-1.4061057196192324],
        [-14.999999999999998,-0.7579579579579572,-1.5382656788062183,-1.0894894894894889],
        [-15.5019305019305,-0.7584402935754277,-1.148575602629656,-1.0755388593226418],
        [-15.984555984555982,-1.0904356093545275,-0.888633807552726,-1.3066703769406467],
        [-16.505791505791503,-1.148594153999559,-0.5998817350168695,-1.379224784630189],
        [-17.007722007722005,-1.5382656788062183,-0.41201201201201165,-1.754481895022435],
        [-17.509652509652508,-2.00000927568495,-0.2385567034215672,-2.0144051387294626],
        [-18.01158301158301,-2.2022934131042238,-0.03627256600229467,-2.46173432119378],
        [-18.494208494208493,-2.836991431586025,-0.20876320335779708-0.5,-3.2694238640184583],
        [-18.996138996138995,-2.8807170104467392,0.1809083214488627-0.5,-3.327563857293587],
        [-19.498069498069498,-2.910028174893039,1.0894987651744417,-3.356875021739886]])

        livermore17_uvlf_z6[:,2]=livermore17_uvlf_z6[::-1,2]

        livermore17_uvlf_uplims=np.ones(len(livermore17_uvlf_z6))!=1
        livermore17_uvlf_uplims[1:3]=True

        livermore17_uvlfs=[[6.0],[livermore17_uvlf_z6, livermore17_uvlf_uplims]]
        
        ono18_schecter=[[4.0,5.0,6.0,7.0],[[-20.63,3.04,-1.57],[-20.86,1.06,-1.6],[-20.91,0.54,-1.87],[-20.77,0.438,-1.97]]] #z=4,5,6,6


        ishigaki18_UVLF_z8=np.asarray([-21.489, -4.6905,
        -20.987, -4.3929,
        -20.498, -3.9762,
        -19.996, -3.5952,
        -19.493, -3.3810,
        -18.991, -2.8571,
        -18.251, -3.3333,
        -17.260, -2.8333,
        -16.249, -1.9286,
        -15.251, -1.3929,
        -14.247, -0.60714]).reshape((-1,2)).T
        ishigaki18_UVLF_ups_z8=np.asarray([-21.489, -4.1905,
        -20.987, -4.0238,
        -20.498, -3.8214,
        -19.996, -3.6071,
        -19.493, -3.3690,
        -18.991, -2.8571,
        -18.251, -3.0357,
        -17.247, -2.4643,
        -16.242, -1.6310,
        -15.251, -1.3929,
        -14.247, -0.59524]).reshape((-1,2)).T
        ishigaki18_UVLF_dws_z8=np.asarray([-21.489, -5.4643,
        -20.987, -4.8452,
        -20.498, -4.2381,
        -19.996, -3.7500,
        -19.493, -3.3810,
        -18.991, -2.8571,
        -18.238, -3.6667,
        -17.247, -3.2857,
        -16.242, -2.2738,
        -15.251, -2.5357,
        -14.247, -1.7619]).reshape((-1,2)).T
        ishigaki18_UVLF_z9=np.asarray([-20.991678224687934, -4.771516397897381,
        -19.986352114574412, -3.482445575850329,
        -18.983460797655642, -3.068378558167644,
        -17.98206513941365, -3.1918138774516405,
        -16.991765181587745, -2.3027665337675374,
        -15.989291257788079, -2.0387001682616006,
        -14.985426023591408, -1.2746316288331685,
        -13.966882464706371, -0.23554015452241095]).reshape((-1,2)).T
        ishigaki18_UVLF_ups_z9=np.asarray([-20.97633902756099, -4.2589924304018725,
        -19.972439010604397, -3.482423836625376,
        -18.983460797655642, -3.068378558167644,
        -17.98206513941365, -3.1918138774516405,
        -16.977017291379532, -2.0027434901890873,
        -15.987865164631152, -1.5261979399910433,
        -14.97005204370454, -0.7496076069895955,
        -13.980795568676388, -0.23556189374736408]).reshape((-1,2)).T
        ishigaki18_UVLF_dws_z9=np.asarray([-20.97985208631342, -5.521497919556172,
        -19.986352114574412, -3.482445575850329,
        -18.983460797655642, -3.068378558167644,
        -17.985195587806906, -4.316818768777255,
        -16.97872164661586, -2.615246153244144,
        -15.991413006143507, -2.801203483493406,
        -14.987582554706762, -2.0496349984130364,
        -13.984030365349417, -1.3980669481171655]).reshape((-1,2)).T

        ishigaki_uplims_z9=[False,False,False,True,False,False,False,True]

        ishigaki18_UVLF_dws_z9[:,ishigaki_uplims_z9]=ishigaki18_UVLF_z9[:,ishigaki_uplims_z9]-0.1

        ishigaki_uplims_z8=[False,False,False,False,False,False,False,False,False,True,True]


        ishigaki18_UVLF_dws_z8[:,ishigaki_uplims_z8]=ishigaki18_UVLF_z8[:,ishigaki_uplims_z8]-0.1

        ishigaki18_uvlfs=[[8.0,9.0],[[ishigaki18_UVLF_z8, ishigaki18_UVLF_dws_z8, ishigaki18_UVLF_ups_z8, ishigaki_uplims_z8],[ishigaki18_UVLF_z9, ishigaki18_UVLF_dws_z9, ishigaki18_UVLF_ups_z9, ishigaki_uplims_z9]]]
        

        bowler20_UVLF_z9=np.asarray([[-21.9,0.84,0.49],
                            [-22.9,0.16,0.11]])

        bowler20_UVLF_z8=np.asarray([[-21.65,2.95,0.98],
                            [-22.15,0.58,0.33],
                            [-22.90,0.14,0.06]])

        bowler20_uvlfs=[[8.0,9.0],[bowler20_UVLF_z8, bowler20_UVLF_z9]]

        oesch18_UVLF=np.asarray([[-22.25,.017,0.1,0.1],
                               [-21.25,.01,0.008,0.022],
                               [-20.25,0.1,0.05,0.1],
                               [-19.25,.34,0.22,0.45],
                               [-18.25,1.9,1.2,2.5],
                               [-17.25,6.3,5.2,14.9]])

        oesch18_uplims=np.zeros(len(oesch18_UVLF))!=0
        oesch18_uplims[0]=True

        oesch18_uvlfs=[[10.0],[oesch18_UVLF, oesch18_uplims]]

        bouw21_LFs=[]
        bouw21_redshifts=[]
        cur_LF=[]

        with open(os.path.join(dir_path,'../constraints/bouw21_mag_tab'),'r') as src:
                 for il,line in enumerate(src):
                    if il<2:continue
                    if '#z=' in line:
                        if len(cur_LF)>0:bouw21_LFs.append(np.transpose(cur_LF))
                        bouw21_redshifts.append(int(line[3:5]))
                        cur_LF=[]  
                    else:
                        cur_LF.append(np.float32(line.rstrip('\n').split(',')))
        bouw21_LFs.append(np.transpose(cur_LF))

                        
        bouwens21_uvlfs=[bouw21_redshifts,bouw21_LFs]
        
        atek18_UVLF=np.asarray([[-21.86,-4.58,.15],
        [-21.36,-4.57,.19],
        [-20.86,-4.03,.12],
        [-20.36,-3.64,.09],
        [-19.86,-3.32,.08],
        [-19.36,-3.05,.08],
        [-18.61,-2.69,.08],
        [-18.25,-2.42,.09],
        [-17.75,-2.22,.08],
        [-17.25,-1.98,.08],
        [-16.75,-1.81,.2],
        [-16.25,-1.71,.15],
        [-15.75,-1.54,.36],
        [-15.25,-1.36,.37],
        [-14.75,-1.39,.71],
        [-14.25,-1.38,.53],
        [-13.75,-1.47,.73],
        [-13.25,-1.56,1.4]])

        atek18_uvlfs=[[6.0],[atek18_UVLF]]

        ono18_UVLF_z4=np.asarray([-23.84280236149588,-7.239745547326904,
        -23.63732038854267,-6.923599540433406,
        -23.449385503757604,-6.486026489736844,
        -23.243903530804392,-6.169880482843344,
        -23.055133070392273,-6.0238039580421665,
        -22.849859991345824,-5.634783819674822,
        -22.644447649694868,-5.294346435623374,
        -22.456234239700784,-4.9539388935586075,
        -22.25054337284081,-4.710667018138954,
        -22.04499176858534,-4.4188123884034045,
        -21.85663909598675,-4.126987600654534,
        -21.65101786042903,-3.859424348076932,
        -21.44532699356905,-3.6161524726572796,
        -21.239496864104566,-3.4214633515535233,
        -21.050865666296957,-3.2268040724364484,
        -20.844896274227963,-3.0806977056485905,
        -20.647387085382896,-2.98318901416997,
        -20.449877896537835,-2.885680322691349,
        -20.243838873166585,-2.763865333061439,
        -20.055068412754466,-2.617788808260261,
        -19.848994573732092,-2.5081195072093263]).reshape((-1,2)).T

        ono18_UVLF_err_z4=np.asarray([-6.681043872694085,-9.037307457015105,
        -6.449932606846747,-8.016711512541097,
        -6.170208744696829,-6.8746586822773414,
        -5.951258088421806,-6.461347166752048,
        -5.829443098791898,-6.2423965104770245,
        -5.634753977688141,-5.804793617793782]).reshape((-1,2)).T


        ono18_UVLF_z5=np.asarray([-24.25090470446321,-8.59760956175299,
        -23.507840772014475,-7.904382470119522,
        -23.001206272617612,-6.398406374501993,
        -22.747889022919182,-5.681274900398407,
        -22.51145958986731,-5.179282868525897,
        -22.241254523522315,-4.772908366533865,
        -22.004825090470447,-4.390438247011953,
        -21.751507840772014,-4.079681274900398,
        -21.498190591073584,-3.8406374501992038,
        -21.261761158021713,-3.577689243027889,
        -21,-3.3984063745019926]).reshape((-1,2)).T


        ono18_UVLF_err_z5=np.zeros((2,len(ono18_UVLF_z5.T)))

        ono18_UVLF_err_z5[:,:3]=(np.asarray([-7.808764940239044,-9.458167330677291,
        -6.6852589641434275,-9.314741035856573,
        -6.06374501992032,-6.852589641434263]).reshape((-1,2)).T)

        ono18_uvlfs=[[5.0,4.0],[[ono18_UVLF_z5[0], ono18_UVLF_z5[1], ono18_UVLF_err_z5[0], ono18_UVLF_err_z5[1]],[ono18_UVLF_z4[0], ono18_UVLF_z4[1], ono18_UVLF_err_z4[0], ono18_UVLF_err_z4[1]]]]
        
        fink15_uvlf_z7=np.asarray([[0.0029,0.0029,0.0029],
        [0.0029,0.0029,0.0029],
        [0.0046,0.0028,0.0049],
        [0.0187,0.0067,0.0085],
        [0.0690,0.0144,0.0156],
        [0.1301,0.0200,0.0239],
        [0.2742,0.0329,0.0379],
        [0.3848,0.0586,0.0633],
        [0.5699,0.1817,0.2229],
        [2.5650,0.7161,0.8735],
        [3.0780,0.8845,1.0837]]) #uvlf,low,high

        fink15_uvlf_z7_uplims=np.ones(len(fink15_uvlf_z7[:,0]))==0
        fink15_uvlf_z7_uplims[:2]=True#

        fink15_uvlf_z6=np.asarray([[0.0025,0.0025,0.0025],
        [0.0025,.0025,0.0025],
        [0.0091,0.0039,0.0057],
        [0.0338,0.0085,0.0105],
        [0.0703,0.0128,0.0148],
        [0.1910,0.0229,0.0249],
        [0.3970,0.0357,0.0394],
        [0.5858,0.0437,0.0527],
        [0.8375,0.0824,0.0916],
        [2.4450,0.3515,0.3887],
        [3.6662,0.8401,1.0076],
        [5.9126,1.2338,1.4481]])#uvlf,low,high

        fink15_uvlf_z6_uplims=np.ones(len(fink15_uvlf_z6[:,0]))==0
        fink15_uvlf_z6_uplims[:2]=True

        fink15_uvlf_z5=np.asarray([[-23.0,-22.5,-22.0,-21.5,-21.0,-20.5,-20.0,-19.5,-19.0,-18.5,-18.0,-17.5],
                                [0.0023,0.0082,0.0082,0.0758,0.2564,0.5181,0.9315,1.2086,2.0874,3.6886,4.7361,7.0842],
                                [0.0,0.0050,0.0051,0.00137,0.0255,0.0365,0.0477,0.0488,0.1212,0.3864,0.4823,1.2892],
                                [0.002,0.0035,0.0036,0.0125,0.0240,0.0338,0.0482,0.666,0.1147,0.3725,0.4413,1.1364]])#mag,uvlf,low,high

        fink15_uvlf_z5_uplims=np.ones(len(fink15_uvlf_z5[0]))==0
        fink15_uvlf_z5_uplims[0]=True

        fink15_uvlfs=[[7.0,6.0,5.0],[[fink15_uvlf_z7, fink15_uvlf_z7_uplims],[fink15_uvlf_z6, fink15_uvlf_z6_uplims],[fink15_uvlf_z5, fink15_uvlf_z5_uplims]]]
        

        bouwens_2015_mags=[]
        bouwens_2015_uvlf=[]
        bouwens_2015_uvlf_err=[]
        bouwens_2015_zeds=[]

        with open(os.path.join(dir_path,'../constraints/bouwens2015_uvlf.txt'),'r') as src:
            reds=0.0 #get from file
            for line in src:

                if 'z=' in line:
                    reds=float(line.split('=')[-1:][0].strip('\n'))

                elif '<' in line or line=='\n':
                    continue


                else:

                    number_line=np.float32(line.strip('\n').split(','))

                    bouwens_2015_mags.append(number_line[0])
                    bouwens_2015_uvlf.append(number_line[1])   
                    if len(number_line)>2:
                        bouwens_2015_uvlf_err.append(number_line[2])            
                    else:
                        bouwens_2015_uvlf_err.append(0)
                    bouwens_2015_zeds.append(reds)


        bouwens_2015_mags=np.asarray(bouwens_2015_mags)
        bouwens_2015_uvlf=np.asarray(bouwens_2015_uvlf)
        bouwens_2015_uvlf_err=np.asarray(bouwens_2015_uvlf_err)
        bouwens_2015_zeds=np.asarray(bouwens_2015_zeds)

        bouwens15_uvlfs_part=[[bouwens_2015_mags[i],bouwens_2015_uvlf[i],bouwens_2015_uvlf_err[i]] for i in range(len(bouwens_2015_zeds))]
        bouwens15_uvlfs=[bouwens_2015_zeds,bouwens15_uvlfs_part]
        
        bouwens_tab=np.genfromtxt(os.path.join(dir_path,'../constraints/bouwens2017_uvlf_z6.txt'),skip_header=1,dtype=np.float32,delimiter=',')

        np.shape(bouwens_tab.T)

        bw2017_mag,bw2017_uvlf,bw2017_uvlf_dw,bw2017_uvlf_up=bouwens_tab.T

        bouwens17_uvlfs=[[6.0],[[bw2017_mag,bw2017_uvlf,bw2017_uvlf_dw,bw2017_uvlf_up]]]
        
        return({'wu2020':wu2020_uvlfs, 'ishigaki18':ishigaki18_uvlfs, 'bowler20':bowler20_uvlfs, 'oesch18':oesch18_uvlfs, 'ono18':ono18_uvlfs, 'fink15':fink15_uvlfs, 'bouwens15':bouwens15_uvlfs, 'bouwens17':bouwens17_uvlfs, 'livermore17':livermore17_uvlfs, 'atek18':atek18_uvlfs, 'vijayan20':vij20_uvlfs, 'bouwens21':bouwens21_uvlfs})
